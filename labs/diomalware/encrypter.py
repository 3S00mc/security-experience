import os
import sys
import hashlib

def encrypt_file(input_file_path, output_file_path, key):
    """
    Encrypts a file using XOR with the key repeated to match data length.

    :param input_file_path: Path to the input file to encrypt.
    :param output_file_path: Path to save the encrypted output file.
    :param key: The key used for encryption (bytes).
    """
    # Read the data from the input file
    with open(input_file_path, 'rb') as input_file:
        data = input_file.read()

    # Encrypt using XOR with key repeated
    encrypted_data = bytes([b ^ key[i % len(key)] for i, b in enumerate(data)])

    # Write the encrypted data to the output file
    with open(output_file_path, 'wb') as output_file:
        output_file.write(encrypted_data)

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("Usage: python encrypter.py <input_file> <output_file>")
        sys.exit(1)
    
    input_file = sys.argv[1]
    output_file = sys.argv[2]
    
    # Load key from key.txt and derive a 32-byte key using SHA-256
    with open('key.txt', 'r') as f:
        key_str = f.read().strip()
    
    key = hashlib.sha256(key_str.encode()).digest()
    
    encrypt_file(input_file, output_file, key)
    print(f"File encrypted successfully: {output_file}")

    # Optional: Remove the original file after encryption
    os.remove(input_file)
    print(f"Original file removed: {input_file}")

